# VK-to-TG Video Poster

Этот скрипт отслеживает новые посты на стене сообщества VK, скачивает прикрепленные к ним видео и публикует их в Telegram-канал, используя ваш личный аккаунт (через Telethon) для поддержки файлов до 2 ГБ.

## Настройка

1. **Установите зависимости.**
    У вас должен быть установлен [uv](https://github.com/astral-sh/uv).

    ```bash
    uv pip install -r requirements.txt
    ```

2. **Настройте переменные окружения.**
    Скопируйте `.env.example` в `.env` и заполните его вашими данными.

    - `VK_SERVICE_TOKEN`: Сервисный ключ доступа вашего VK-приложения.
    - `TELEGRAM_API_ID` и `TELEGRAM_API_HASH`: Получите их на [my.telegram.org](https://my.telegram.org) в разделе "API development tools".

3. **Настройте конфигурационный файл.**
    Отредактируйте файл `config.yaml` для настройки поведения скрипта.

4. **Авторизация в VK в браузере.**
    Для скачивания видео `yt-dlp` требуются cookies. Войдите в свой аккаунт `vk.com` в браузере, который вы указали в `config.yaml` (секция `downloader`, параметр `browser`).

## Конфигурация (`config.yaml`)

- **`app`**:
  - `wait_time_seconds`: Пауза в секундах между проверками новых постов.
- **`vk`**:
  - `domain`: Короткое имя или ID сообщества VK (например, `durov`).
  - `post_count`: Количество постов, запрашиваемых при каждой проверке.
  - `post_source`: Источник постов. Может быть `wall` (обычные посты) или `donut` (для платных подписчиков VK Donut).
- **`telegram`**:
  - `channel_ids`: Список ID ваших Telegram-каналов (например, `@my_channel` или `-100123456789`).
- **`downloader`**:
  - `browser`: Браузер, из которого будут импортированы cookies для `yt-dlp` (например, `chrome`, `firefox`, `edge`).
  - `output_path`: Директория для сохранения скачанных видео.
  - `yt_dlp_opts`: Опции для `yt-dlp`.
    - `concurrent_fragment_downloads`: Количество одновременно скачиваемых фрагментов.
    - `skip_unavailable_fragments`: Пропускать ли недоступные фрагменты.
    - `fragment_retries`: Количество попыток скачивания для каждого фрагмента.
    - `retries`: Общее количество попыток скачивания.
    - `external_downloader`: Внешний загрузчик (`aria2c`, `native`).
    - `external_downloader_args`: Аргументы для внешнего загрузчика.

## Запуск

    ```bash
    uv run python main.py
    ```

### Важно: Первый запуск

При первом запуске `Telethon` попросит вас ввести номер телефона, код из Telegram и, возможно, пароль двухфакторной аутентификации прямо в консоли. После успешной авторизации будет создан файл `user_session.session`, и в дальнейшем вход будет происходить автоматически.
